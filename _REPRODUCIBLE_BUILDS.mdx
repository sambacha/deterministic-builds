---
title: Deterministic Build
version:
man:
---

## debuerreotype

reproduciable debian images, this is what the offical docker images use

### Git

```bash
$ GIT_AUTHOR_DATE="Thu, 01 Jan 1970 00:00:00 +0000" GIT_COMMITTER_DATE="Thu, 01 Jan 1970 00:00:00 +0000" git commit --allow-empty -m 'Initial commit'
```

### strftime()

The C and POSIX standards define for the strftime() function and the date utility
a notation for defining date and time representations. 
Here are some examples, of how they can be used to produce ISO 8601 output:

```bash
format string 	output
%Y-%m-%d 	      1999-12-31
%Y-%j 	        1999-365
%G-W%V-%u      	1999-W52-5
%H:%M:%S      	23:59:59
```


### Reproducible Builds 

```bash
export SOURCE_DATE_TZOFFSET = $(shell dpkg-parsechangelog -SDate | tail -c6)
```

`LC_ALL=C date -u -d '2015-10-21' `


In some cases, it is preferable to keep the original times for files that have
not been created or modified during the build process:

```bash
$ find build -newermt "@${SOURCE_DATE_EPOCH}" -print0 |
    xargs -0r touch --no-dereference --date="@${SOURCE_DATE_EPOCH}"
$ zip -r product.zip build
```

`--clamp-mtime` flag which will only set the time when the file is more recent
than the value specified with --mtime:

```bash
$ tar --mtime='2015-10-21 00:00Z' --clamp-mtime -cf product.tar build
```

#### Creating a Tarball

Works with GNU Tar 1.28
> note: Mac Users must use GNU Utils, as BSDTAR does not have some of these options. use `gtar` with `g` prefix denoting `GNU` core utils

```bash
$ tar --sort=name -cf product.tar build
```
For older versions or other archive formats, it is possible to use find and sort
to achieve the same effect:

```bash
$ find build -print0 | LC_ALL=C sort -z |
    tar --no-recursion --null -T - -cf product.tar
```

Tar offers a way to specify the user and group owning the file. Using `0/0` and
`--numeric-owner` is a safe bet, as it will effectively record 0 as values:

### Deterministic 
<!-- Lyapunov -->

> Empty Directory is created and archived to be embedded within 

```bash
$ mkdir -p build/.emptydir
$ tar --owner=0 --group=0 --numeric-owner -cf pkg.tar build/.emptydir
$ tar --owner=0 --group=0 --numeric-owner -cf product.tar build
```

Full example
The recommended way to create a Tar archive is thus:

```bash
$ tar --sort=name \
      --mtime="@${SOURCE_DATE_EPOCH}" \
      --owner=0 --group=0 --numeric-owner \
      --pax-option=exthdr.name=%d/PaxHeaders/%f,delete=atime,delete=ctime \
      -cf product.tar build
```

GNU ar and other tools from binutils have a deterministic mode which will use
zero for UIDs, GIDs, timestamps, and use consistent file modes for all files. It
can be made the default by passing the --enable-deterministic-archives option to
./configure


### Famous Timestamps

2009-01-13 12:46:54 PST
[https://web.archive.org/web/20130316013625/http://sourceforge.net/news/?group_id=244765](http://sourceforge.net/news/?group_id=244765)

2009-01-03 18:15:05 UTC

